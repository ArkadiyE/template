%%writefile CommandLine1.py
#!/usr/bin/env python

from pathlib import Path
from pathlib import PurePath
from pathlib import PosixPath
from pathlib import PurePosixPath
import os
import argparse
from jinja2 import Environment, FileSystemLoader, select_autoescape
env = Environment(loader=FileSystemLoader("."), autoescape=select_autoescape())
parser = argparse.ArgumentParser()

parser.add_argument("base_dir", type=str, default=Path.cwd())
parser.add_argument("-syl", "--symlink", action="store_true")
parser.add_argument("-t", "--template", action="store_true")
args = parser.parse_args()

def main():
    args.base_dir = Path(args.base_dir)
    args.base_dir.mkdir()
    ref = Path('ref')
    ref = Path.cwd() / args.base_dir / ref
    ref.mkdir()
    data = Path('data')
    data = Path.cwd() / args.base_dir / data
    data.mkdir()
    notebook = Path('notebook')
    notebook = Path.cwd() / args.base_dir / notebook
    notebook.mkdir()
    notebook.exists()
    results = Path('results')
    results = Path.cwd() / args.base_dir / results
    results.mkdir()
    results.exists()
    utils = Path('utils')
    utils = Path.cwd() / args.base_dir / utils
    utils.mkdir()
    utils.exists()
    
def make_symlink(link, dest):
    parser.add_argument("link", type=str)
    parser.add_argument("destination", type=str)
    reflink = args.link + 'ref'
    reflink = ref / Path(args.link)
    dest = '/home/arkadiy/reference/' + args.destination
    reflink.symlink_to(Path(dest))
    
def do_render():
    parser.add_argument("filename", type=str)
    parser.add_argument("PATTERN", type=str)
    parser.add_argument("RUNID", type=str, default="")
    parser.add_argument("NPROC", type=str)
    parser.add_argument("base_dir", type=str)
    args = parser.parse_args()
    kwargs = vars(args)
    kwargs = args.PATTERN, args.RUNID, args.NPROC, args.base_dir
    env = Environment(loader=FileSystemLoader("."),autoescape=select_autoescape())
    path = Path(args.filename)
    path.exists()
    template = env.get_template(args.filename)
    return template.render(**kwargs)
    
if args.base_dir != "":
    main()
    if args.symlink:
        make_symlink(args.link, args.destination)
    elif args.template:
        do_render()
else:
    main()
